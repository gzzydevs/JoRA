{
  "id": "task-035-resolve-pkg-vite-compatibility",
  "title": "Resolver definitivamente nexe + Vite para binarios funcionales",
  "description": "Migrar de PKG (deprecado) a nexe e implementar la soluciÃ³n definitiva para generar binarios funcionales multiplataforma. Esta es la tarea BLOQUEANTE para v0.2.0 compilable.\n\n## ğŸ¯ **Objetivo**\nLograr que `npm run build` genere binarios funcionales para Windows, macOS y Linux que ejecuten JoRA sin dependencias externas usando nexe.\n\n## ğŸš§ **Problemas Conocidos (desde task-022)**\n- PKG estÃ¡ deprecado y tiene problemas con Vite\n- Paths relativos no funcionan en binarios\n- Dynamic imports pueden fallar\n- Node modules no se incluyen correctamente\n- Frontend build no se sirve desde el binario\n\n## ğŸ”¬ **SoluciÃ³n: nexe (ELEGIDO)**\n\n### **Â¿Por quÃ© nexe?**\n- âœ… Activamente mantenido (vs PKG deprecado)\n- âœ… Mejor soporte para modern Node.js\n- âœ… MÃ¡s compatible con Vite builds\n- âœ… Cross-compilation support\n- âœ… Mejor asset bundling\n\n### **nexe Implementation Strategy:**\n```bash\n# Install nexe globally\nnpm install -g nexe\n\n# Cross-compilation desde macOS:\nnexe -t windows-x64-18.0.0 -o dist/jora-win.exe src/cli.js\nnexe -t linux-x64-18.0.0 -o dist/jora-linux src/cli.js  \nnexe -t darwin-x64-18.0.0 -o dist/jora-mac src/cli.js\n```\n\n4. **electron-builder** (Desktop app approach)\n   - MÃ¡s pesado pero mÃ¡s confiable\n   - Native OS integration\n\n5. **esbuild + Custom bundling**\n   - Modern bundler mÃ¡s compatible\n   - Better tree shaking\n\n## ğŸ§ª **Testing Matrix**\n\n### **Platforms to test:**\n- âœ… **Windows 10/11** (x64)\n- âœ… **macOS** (Intel + Apple Silicon)\n- âœ… **Linux Ubuntu** (x64)\n\n### **Test scenarios:**\n- âœ… Binario ejecuta sin Node.js instalado\n- âœ… Frontend se sirve correctamente\n- âœ… API endpoints funcionan\n- âœ… JSON database read/write funciona\n- âœ… Git operations funcionan (save button)\n- âœ… Port binding works (3333)\n\n## ğŸ“‹ **Plan de ImplementaciÃ³n**\n\n### **Fase 1: DiagnÃ³stico completo**\n```bash\n# Current build process\nnpm run build:frontend  # âœ… Funciona\nnpm run build           # âŒ Binarios no funcionan\n\n# Test each binary\n./dist/jora-linux\n./dist/jora-win.exe\n./dist/jora-mac\n```\n\n### **Fase 2: SoluciÃ³n PKG (primera opciÃ³n)**\n```javascript\n// package.json - Enhanced PKG config\n\"pkg\": {\n  \"assets\": [\n    \"dist/frontend/**/*\",\n    \"jora-changelog/**/*\",\n    \"node_modules/express/**/*\"\n  ],\n  \"scripts\": [\n    \"src/**/*.js\"\n  ],\n  \"targets\": [\n    \"node18-linux-x64\",\n    \"node18-win-x64\", \n    \"node18-macos-x64\"\n  ],\n  \"outputPath\": \"dist\"\n}\n```\n\n### **Fase 3: Alternativa si PKG falla**\nImplementar electron-builder o nexe segÃºn testing\n\n### **Fase 4: OptimizaciÃ³n**\n- Bundle size reduction\n- Startup time optimization\n- Memory usage optimization\n\n## ğŸ”§ **Archivos a modificar**\n\n### **Build Scripts:**\n```json\n// package.json\n\"scripts\": {\n  \"build\": \"npm run build:frontend && npm run build:binaries\",\n  \"build:binaries\": \"npm run build:linux && npm run build:win && npm run build:mac\",\n  \"build:linux\": \"pkg . --targets node18-linux-x64 --output dist/jora-linux\",\n  \"build:win\": \"pkg . --targets node18-win-x64 --output dist/jora-win.exe\",\n  \"build:mac\": \"pkg . --targets node18-macos-x64 --output dist/jora-mac\",\n  \"test:binaries\": \"node scripts/test-binaries.js\"\n}\n```\n\n### **Server modifications:**\n```javascript\n// src/server/server.js\n// Fix static file serving in bundled mode\nconst frontendPath = process.pkg \n  ? path.join(path.dirname(process.execPath), 'frontend')\n  : path.join(__dirname, '../../dist/frontend');\n```\n\n## âœ… **Criterios de Ã©xito para v0.2.0**\n\n### **Must Have:**\n- âœ… `./jora-linux` ejecuta y abre browser en localhost:3333\n- âœ… `./jora-win.exe` funciona en Windows sin Node.js\n- âœ… `./jora-mac` funciona en macOS\n- âœ… Todas las funcionalidades de JoRA operativas en binarios\n- âœ… Size < 100MB por binario\n\n### **Nice to Have:**\n- âœ… Auto-detection de puerto libre\n- âœ… Startup time < 5 seconds\n- âœ… Graceful error handling\n- âœ… Version info en binarios\n\n## ğŸš€ **Testing Commands**\n```bash\n# Build test\nnpm run build\n\n# Local test\n./dist/jora-linux &\ncurl http://localhost:3333\n\n# Clean environment test\n# (En VM sin Node.js instalado)\n./jora-linux\n```\n\n---\n\n**NOTA CRÃTICA:** Esta tarea es BLOQUEANTE absoluto para v0.2.0. Sin binarios funcionales, v0.2.0 no puede ser la primera versiÃ³n compilable. EstimaciÃ³n: 13-21 puntos dependiendo de cuÃ¡ntas alternativas hay que probar.",
  "state": "todo",
  "type": "feature",
  "priority": "critical",
  "epic": "distribution-automation",
  "author": "gzzy",
  "assignee": null,
  "tags": [
    "pkg",
    "vite",
    "binary",
    "compilation",
    "distribution",
    "v0.2.0",
    "blocker",
    "critical"
  ],
  "subtasks": [
    {
      "id": "subtask-1",
      "text": "Completar diagnÃ³stico detallado de problemas PKG + Vite actuales",
      "completed": false
    },
    {
      "id": "subtask-2",
      "text": "Probar configuraciÃ³n avanzada de PKG con assets customizados",
      "completed": false
    },
    {
      "id": "subtask-3",
      "text": "Evaluar nexe como alternativa a PKG",
      "completed": false
    },
    {
      "id": "subtask-4",
      "text": "Evaluar ncc + custom wrapper approach",
      "completed": false
    },
    {
      "id": "subtask-5",
      "text": "Evaluar electron-builder como plan B",
      "completed": false
    },
    {
      "id": "subtask-6",
      "text": "Implementar soluciÃ³n elegida con testing en 3 platforms",
      "completed": false
    },
    {
      "id": "subtask-7",
      "text": "Optimizar size y startup time de binarios",
      "completed": false
    },
    {
      "id": "subtask-8",
      "text": "Crear testing automatizado para binarios",
      "completed": false
    },
    {
      "id": "subtask-9",
      "text": "Documentar proceso de build definitivo",
      "completed": false
    },
    {
      "id": "subtask-10",
      "text": "Validar que TODAS las funcionalidades JoRA funcionan en binarios",
      "completed": false
    }
  ],
  "estimatedPoints": 21,
  "estimatedDate": "2025-08-01",
  "images": [],
  "createdAt": "2025-07-18T21:15:00Z",
  "updatedAt": "2025-07-18T21:15:00Z"
}
